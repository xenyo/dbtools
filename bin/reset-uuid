#!/usr/bin/env bash

yml_path="config/sync/system.site.yml"
db_path="database.sql"

if [ ! -f $yml_path ]; then
  echo "Error: $yml_path does not exist."
  exit 1
fi

if [ ! -f $db_path ]; then
  echo "Error: $db_path does not exist."
  exit 1
fi

old_uuid=$(grep -Po 'uuid: \K[a-z0-9-]+' $yml_path)

if [ -z $old_uuid ]; then
  echo "Error: could not find old UUID"
  exit 1
fi

echo "Old UUID: $old_uuid"

new_uuid=$(uuidgen)

echo "New UUID: $new_uuid"

sed -i "s/$old_uuid/$new_uuid/gi" $yml_path
sed -i "s/$old_uuid/$new_uuid/gi" $db_path

echo "UUID updated. Please re-import the database and commit the changes."
